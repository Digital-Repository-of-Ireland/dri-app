<div class="dri_object_container">
  <div id="uppy" class="dri_uppy" data-url="<%= object_files_path(@document.id) %>">
    <form id="upload_options" class="uppy_upload_options">
      <%= hidden_field_tag 'authenticity_token', form_authenticity_token %>
      <%= label_tag 'preservation', t('dri.assets.upload_as_preservation') %>
      <%= check_box_tag 'preservation' %>
    </form>
  </div>
</div>

<% content_for :head do %>
  <script type="module">
	  import Uppy from '@uppy/core'
    import Dashboard from '@uppy/dashboard'
    import XHRUpload from '@uppy/xhr-upload'

    const uppy = new Uppy({
      autoProceed: false,
    })

    uppy.use(Dashboard, {
      inline: true,
      target: '#uppy',
    })
    
    var url = $('#uppy').data('url');
    var token = $('#authenticity_token').val();
    uppy.setMeta({'authenticity_token': token});

    uppy.use(XHRUpload, {
      endpoint: url
    })

    uppy.on('upload', (data) => {
	    uppy.setMeta({'preservation': $('#preservation').is(':checked')});
    });
  </script>
<% end %>
